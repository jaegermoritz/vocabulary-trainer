name: ðŸ”– Release

on:
  push:
    branches:
      - main # Trigger the release workflow when changes are pushed to the main branch

permissions:
  contents: write

jobs:
  release_and_deploy:
    name: ðŸ”– Release and Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Setup
        uses: ./.github/workflows/setup.yml
        with:
          node_version: "20" # Specify the Node.js version to use

      - name: Release
        uses: ./.github/workflows/release.yml
        with:
          node_version: "20" # Specify the Node.js version to use
          build_directory: ./dist # Adjust this to your build output directory

      - name: ðŸš€ Deploy Web Application
        uses: ./.github/workflows/deploy.yml
        with:
          build_directory: ./dist # Adjust this to your build output directory
          remote_server: "MY_SERVER_HOST_NAME" # Replace with your server's IP or hostname
          remote_path: /var/www/my-webapp # Adjust this to your server's deployment path
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }} # Pass the secret explicitly
